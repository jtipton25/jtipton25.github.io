<h1>some example code to parallelize the building of random forests</h1>

<h2>load the required libraries</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>knitr<span class="p">)</span>
opts_chunk<span class="o">$</span>set<span class="p">(</span>cache <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>randomForest<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>parallel<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>snowfall<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>rlecuyer<span class="p">)</span>
</code></pre></div>
<h2>load the data and set up the model</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## load the data</span>
theData <span class="o">&lt;-</span> iris

<span class="c1"># set the formula</span>
theFormula <span class="o">&lt;-</span> as.formula<span class="p">(</span><span class="s">&quot;Species ~ . &quot;</span><span class="p">)</span>

<span class="c1"># total number of trees in the random forest</span>
totalTrees <span class="o">&lt;-</span> <span class="m">500</span>
</code></pre></div>
<h2>Setup the parallel functions</h2>

<h2>Fit the random forest</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># build the random forests</span>
allForests <span class="o">&lt;-</span> sfClusterApplyLB<span class="p">(</span><span class="m">1</span><span class="o">:</span>threads<span class="p">,</span> parallelRF<span class="p">)</span>

<span class="c1"># Close the cluster</span>
sfStop<span class="p">()</span>
</code></pre></div>
<h2>Process forest output</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># merge all the forests into one object</span>
myRandomForest <span class="o">&lt;-</span> allForests<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">2</span><span class="o">:</span>threads<span class="p">)</span> <span class="p">{</span>
    myRandomForest <span class="o">&lt;-</span> combine<span class="p">(</span>myRandomForest<span class="p">,</span> allForests<span class="p">[[</span>i<span class="p">]])</span>
<span class="p">}</span>

<span class="c1"># convince oursleves we have them all combined</span>
myRandomForest<span class="o">$</span>ntree
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 496
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># what is important</span>
myRandomForest<span class="o">$</span>importance
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">##              MeanDecreaseGini
## Sepal.Length        10.025435
## Sepal.Width          2.556842
## Petal.Length        44.540894
## Petal.Width         42.111466
</code></pre></div>